![](_page_0_Picture_0.jpeg)

# F900智能人脸识别模组 通信接口应用手册

![](_page_0_Picture_2.jpeg)

#### 目 录

| 1. 通信协议说明                               | 2  |
|-----------------------------------------|----|
| 1.1. 串口配置说明                             | 2  |
| 1.2. 通信消息格式                             | 2  |
| 1.3. 通信消息详细说明                           | 3  |
| 1.3.1. 消息头文件定义                          | 3  |
| 1.3.2. 消息列表                             |    |
| 1.4. 模组消息的发送和接收                         |    |
| 1.4.1. 消息接收(H>>M)                       |    |
| 1.4.2. 消息发送(M>>H)                       |    |
| 1.5. 上下电流程                              |    |
| 1.6. 主控接收消息流程                           |    |
| 1.7. 一般消息处理流程                           |    |
| 1.8. 录入流程                               |    |
| 1.9. 解锁流程                               |    |
| 1.10. 加密通信流程                            |    |
| 1.11. OTA 升级流程                          |    |
| 1.12. 补充说明                              |    |
| 1.12.1. 设置加密规则 MID_SET_RELEASE_ENC_KEY  |    |
| 1.12.2. 进入加密模式 MID_INIT_ENCRYPTION      |    |
| 1.12.3. 待机指令 MID_RESET                  |    |
| 1.12.4. 获取模组状态 MID_GETSTATUS            |    |
| 1.12.5. 识别MID_VERIFY                    |    |
| 1.12.6. 录入指令                            |    |
| 1.12.7. 清除人脸录入状态 MID_FACERESET          |    |
| 1.12.8. 删除单个用户 MID_DELUSER              |    |
| 1.12.9. 删除所有用户 MID_DELALL               |    |
| 1.12.10. 获取指定 ID 的用户信息 MID_GETUSERINFO  |    |
| 1.12.11. 获取已注册用户的 ID MID_GET_ALL_USERID |    |
| 1.12.12. 演示模式 MID_DEMOMODE              |    |
| 1.12.13. 设置安全等级 MID_SET_THRESHOLD_LEVEL |    |
| 1.12.14. 图像抓拍                           |    |
| 1.12.15. 获取断电保存的日志                      |    |
| 1.12.16. 获取售后 debug 日志                  | 36 |

![](_page_2_Picture_1.jpeg)

# **产品文档修订记录**

| 版本   | 修订日期   | 说明       | 修订作者 |
|------|--------|----------|------|
| V1.0 | 2023.3 | 创建       | 城章科技 |
| V1.1 | 2023.7 | 通讯内容详细解答 | 城章科技 |
|      |        |          |      |
|      |        |          |      |

![](_page_3_Picture_1.jpeg)

## <span id="page-3-0"></span>**1.通信协议说明**

人脸模组和主控之间采用串口方式通信,人脸模组始终处于从机地位,主 控需通过发送不同的指令让模组完成相应的功能。主控发送给模组的指令、模 组对主控的应答需按照规定的格式来进行。本章将阐述串口的配置及通信的协 议。

## <span id="page-3-1"></span>**1.1.** 串口配置说明

| 表        | 1-1                      |
|----------|--------------------------|
| 配置项      | 说明                       |
| 波特率      | 支持大多波特率,<br>默认<br>115200 |
| 硬件/软件流控制 | 不使用                      |
| 数据位      | 8                        |
| 停止位      | 1                        |
| 奇偶校验位    | 不使用                      |
| 信号电平     | 3.3V                     |

## <span id="page-3-2"></span>**1.2.** 通信消息格式

主控与模组通信的基本消息格式如表 1-2 所示。

表 1-2

| SyncWord | MsgID | Size  | Data  | ParityCheck |
|----------|-------|-------|-------|-------------|
| 2        | 1     | 2     | N     | 1           |
| bytes    | byte  | bytes | bytes | byte        |

表 1-3 是对各个字段的详细说明。

表 1-3

| 字段       | 长度         | 说明                                         |
|----------|------------|--------------------------------------------|
| SyncWord | 2bytes     | 固定的消息开头同步字<br>0xEF<br>0xAA                 |
| MsgID    | 1byte      | 消息<br>(例如<br>ID<br>RESET)                  |
| Size     | 2bytes     | 单位<br>Data<br>size,<br>byte                |
| Data     | N<br>bytes | 消息对应的<br>如<br>消息对应的参数。<br>data,<br>command |
|          |            | 65535>=N>=0,N=0<br>表示此消息无参数。               |
| Parity   | 1<br>byte  | 协议的奇偶校验码,计算方式为整条协议除去<br>Sync               |
| Check    |            | 部分后,其余字节按位做<br>运算。<br>Word<br>XOR          |

![](_page_4_Picture_1.jpeg)

## <span id="page-4-0"></span>**1.3.** 通信消息详细说明

## <span id="page-4-1"></span>**1.3.1.**消息头文件定义

<span id="page-4-2"></span>消息头文件定义见F900手册-1 。

## **1.3.2.**消息列表

表1-4 中列出了模组(M)和主控(H)的所有通信消息。每条消息处理都对应有超时 时间定义,**Timeout** 指的是主控等待模组处理的最长时间,即模组反馈处理完成的时 间。

当指令处理超时,主控可采用如下几种处理方式:

- 1 发送MID\_GETSTATUS 指令 此消息能快速获取模组的工作状态,若死机则无返回,主控可直接断电。
- 2 发送 RESET 指令 停止所有当前的处理,模组进入 standby 的状态,等待主控新的指令。
- 3 认为模组死机 主控可采用断电重启的处理方式。

|                    | 表1-4 |     |           |                                                                       |
|--------------------|------|-----|-----------|-----------------------------------------------------------------------|
| MsgID              | Code | DIR | Timout(s) | 说明                                                                    |
| MID_REPLY          | 0x00 | M»H | N/A       | 是模组对主控发送出的命<br>Reply<br>令的应答,对于主控的每条命令,<br>模组最终都会进行<br>reply          |
| MID_NOTE           | 0x01 | M»H | N/A       | 是模组主动发给主控的信<br>Note<br>息,<br>根据note<br>判断消息类型和<br>id<br>适配的data<br>结构 |
| MID_IMAGE          | 0x02 | M»H | N/A       | 模组给主控传送图片                                                             |
| MID_RESET          | 0x10 | H»M | 2         | 停止所有当前在处理的消息,<br>模<br>组进入待机状态                                         |
| MID_GETSTATUS      | 0x11 | H»M | 2         | 立即返回模组当前状态                                                            |
| MID_VERIFY         | 0x12 | H»M | 自定义       | 鉴权解锁                                                                  |
| MID_ENROLL         | 0x13 | H»M | 自定义       | 交互式录入                                                                 |
| MID_SNAPIMAGE      | 0x16 | H»M | 10        | 抓拍图片并存储到本地                                                            |
| MID_GETSAVEDIMAGE  | 0x17 | H»M | 2         | 获取待上传图片大小                                                             |
| MID_UPLOADIMAGE    | 0x18 | H»M | 2         | 将本地存储的图片上传到主控                                                         |
| MID_ENROLL_SINGLE  | 0x1D | H»M | 自定义       | 单帧录入                                                                  |
| MID_DELUSER        | 0x20 | H»M | 5         | 删除一个注册用户                                                              |
| MID_DELALL         | 0x21 | H»M | 5         | 删除所有注册用户                                                              |
| MID_GETUSERINFO    | 0x22 | H»M | 2         | 获得某个注册用户的信息                                                           |
| MID_FACERESET      | 0x23 | H»M | 2         | 重置算法状态,如果正在进行交<br>互式录入,会清空已录入的方向                                      |
| MID_GET_ALL_USERID | 0x24 | H»M | 2         | 获取所有已注册用户的数量和<br>ID                                                   |

![](_page_5_Picture_1.jpeg)

| MID_ENROLL_ITG          | 0x26         | H»M        | 自定义 | 集成支持并扩展所有录入方式                           |
|-------------------------|--------------|------------|-----|-----------------------------------------|
| MID_GET_VERSION         | 0x30         | H»M        | 2   | 获得软件版本信息                                |
| MID_START_OTA           | 0x40         | H»M        | 2   | 进入 OTA 升级模式                             |
| MID_STOP_OTA            | 0x41         | H»M        | 2   | 退出 OTA 模式模组重启                           |
|                         |              | H»M        |     | 获取 OTA 状态以及传输升级                         |
| MID_GET_OTA_STATUS      | 0x42         |            | 2   | 包的起始包序号                                 |
| MID_OTA_HEADER          |              |            |     | 发送升级包的大小,总包数,分                          |
|                         | 0x43         | H»M        | 2   | 包的大小,升级包的md5 值                          |
| MID_OTA_PACKET          |              |            |     | 发送升级包:包序号、包大小、                          |
|                         | 0x44         | H»M        | 2   | 包数据                                     |
| MID_INIT_ENCRYPTION     | 0x50         | H»M        | 2   | 设置加密随机数                                 |
| MID_CONFIG_BAUDRATE     | 0x51         | H»M        | 2   | OTA 模式下设定通信口波特率                         |
| MID_SET_RELEASE_ENC_KEY |              |            |     | 设定量产加密秘钥序列,掉电会                          |
|                         | 0x52         | H»M        | 2   | 保存                                      |
| MID_SET_DEBUG_ENC_KEY   | 0.52         | 11.14      | 2   | 设定调试加密秘钥序列,掉电丢                          |
| MID OFT LOOFILE         | 0x53         | H»M        | 2   | 失<br>共取 1 文件 40 士 4                     |
| MID_GET_LOGFILE         | 0x60         | H»M        |     | 获取 log 文件的大小                            |
| MID_UPLOAD_LOGFILE      | 0x61         | H»M        | 2   | 将保存的 log 上传至主控                          |
| MID_SET_THRESHOLD_LEVEL | 0.04         | 11.14      | 2   | <br>  设置算法安全等级                          |
| MID DOWEDDOWN           | 0xD4<br>0xED | H»M<br>H»M | 2   | 模组断电前,保存简单的 log                         |
| MID_POWERDOWN           | UXED         | U»M        | 2   | - · · · · · · · · · · · · · · · · · · · |
| MID_DEBUG_MODE          | 0xF0         | H»M        | 2   | 使能debug 模式, 会存储所有的<br>图片和较多的 log。       |
| MID GET DEBUG INFO      | UXITO        | 11///1/1   |     | 获取debug 模式下存储的数据包                       |
| WITD_GET_DEBUG_TNFO     | 0xF1         | H»M        | 2   | 大小                                      |
| MID_UPLOAD_DEBUG_INFO   | 0xF2         | H»M        | 2   | 上传debug 模式下存储的数据包                       |
| MID_GETLIBRARY_VERSION  | 0xF3         | M»H        | 2   | 获取当前解锁库版本信息                             |
| MID DEMOMODE            | 0xFE         | H»M        | 2   | 进入演示模式                                  |
|                         |              |            |     |                                         |

## <span id="page-5-0"></span>1.4. 模组消息的发送和接收

## <span id="page-5-1"></span>1.4.1. 消息接收(H>>M)

模组接收到的完整协议格式如表 1-5 所示,主控应按照该格式向模组发送命令。

表 1-5

| 名称  | SyncWord | MsgID   | Size    |  | Data    | ParityCheck |
|-----|----------|---------|---------|--|---------|-------------|
| 字节数 | 2 bytes  | 1 byte  | 2 bytes |  | N bytes | 1 byte      |
| 内容  | 0xEFAA   | command | 高八位 低八位 |  | data    | checksum    |

## <span id="page-5-2"></span>1.4.2. 消息发送(M>>H)

模组主要发送三种类型的消息,分别是 REPLY, NOTE, IMAGE。

(1) REPLY 消息的发送

![](_page_6_Picture_1.jpeg)

模组向主控发送的 REPLY 消息的完整协议如表 1-6 所示。

表 1-6

| 名称  | SyncWord | MsgID                   | Size      |                | Data              |                         | ParityCheck |
|-----|----------|-------------------------|-----------|----------------|-------------------|-------------------------|-------------|
| 字节数 | 2 bytes  | 1 byte                  | 2 bytes   |                | N bytes           |                         | 1 byte      |
| 内容  | 0xEFAA   | MID_R<br>EPLY<br>(0x00) | 高八 低八 位 位 | mid<br>(1byte) | result<br>(1byte) | data  data[0]  (n-byte) | checksum    |

mid 表示模组当前正在处理的任务,例如当 mid 为 MID\_ENROLL\_SINGLE 时,表示该消息是模组处理完单帧录入任务后回复的消息。 result 表示该命令的最终执行结果,详细如表 1-7 所示。

表 1-7

| Result                   | code | 说明         |
|--------------------------|------|------------|
| MR_SUCCESS               | 0    | 指令执行成功     |
| MR_REJECTED              | 1    | 模组拒绝该命令    |
| MR_ABORTED               | 2    | 录入/解锁算法已终止 |
| MR_FAILED4_CAMERA        | 4    | 相机打开失败     |
| MR_FAILED4_UNKNOWNREASON | 5    | 未知错误       |
| MR_FAILED4_INVALIDPARAM  | 6    | 无效的参数      |
| MR_FAILED4_NOMEMORY      | 7    | 内存不足       |
| MR_FAILED4_UNKNOWNUSER   | 8    | 未录入的用户     |
| MR_FAILED4_MAXUSER       | 9    | 录入超过最大数量   |
| MR_FAILED4_FACEENROLLED  | 10   | 人脸已录入      |
| MR_FAILED4_LIVENESSCHECK | 12   | 活体检测失败     |
| MR_FAILED4_TIMEOUT       | 13   | 录入或解锁超时    |
| MR_FAILED4_AUTHORIZATION | 14   | 加密芯片授权失败   |
| MR_FAILED4_READ_FILE     | 19   | 读文件失败      |
| MR_FAILED4_WRITE_FILE    | 20   | 写文件失败      |
| MR_FAILED4_NO_ENCRYPT    | 21   | 未采用加密通讯    |

#### (1) NOTE 消息的发送

NOTE 消息主要作用是主动向主控返回一些信息,目前 NOTE 消息主要在二种情况下发送:

- a) 上电握手信号 NID\_READY: 模组上电初始化完成后,会通过串口向主控发送 NID\_READY(EF AA 01 0001 00 00)。主机在接收到握手信号后,可以和模组进行指令 交互。
- b) License 验证失败 NID\_AUTHORIZATION;

![](_page_7_Picture_1.jpeg)

- g 录入/识别过程中模组向主控发送人脸状态信息 NID FACE STATE;
- d) OTA 升级完成,携带升级成功结果 NID\_OTA\_DONE。模组向主控发送的 NOTE 消息的完整协议如表 1-8 所示。

表 1-8

| 名称  | SyncWord | MsgID  | Size    | D       | ata       | ParityCheck |
|-----|----------|--------|---------|---------|-----------|-------------|
| 字节数 | 2 bytes  | 1 byte | 2 bytes | N bytes |           | 1 byte      |
|     |          | MID_N  | 高低八八八   | s_msg_1 | note_data |             |
| 内容  | 0xEFAA   | OTE    |         | nid     | data[0]   | checksum    |
|     |          | (0x01) | J       | (1byte) | (n-bytes) |             |

nid 表示几类 NOTE 信息,详细如下:

表 1-9

| nid (*表示携带 data)  | code | 说明                   |
|-------------------|------|----------------------|
| NID_READY         | 0    | 模组已准备好               |
| NID FACE STATE*   | 1    | 算法执行成功,并返回人          |
| NID_FACE_STATE    | 1    | 脸信息 s_note_data_face |
| NID_UNKNOWNERROR  | 2    | 未知错误                 |
| NID_OTA_DONE*     | 3    | OTA 升级完毕             |
| NID_AUTHORIZATION | 8    | License 验证失败         |

其中 NID\_FACE\_STATE 是录入和比对过程中模组返回的一些人脸状态信息,它所携带的数据 data 主要存储了人脸信息,详细如下:

表 1-10

| 结构 |         | s_note_data_face |         |         |         |         |         |         |  |
|----|---------|------------------|---------|---------|---------|---------|---------|---------|--|
| 内容 | state   | left             | top     | Right   | bottom  | yaw     | pitch   | roll    |  |
| 类型 | int16_t | int16_t          | int16_t | int16_t | int16_t | int16_t | int16_t | int16_t |  |
| 字节 | 2bytes  | 2bytes           | 2bytes  | 2bytes  | 2bytes  | 2bytes  | 2bytes  | 2bytes  |  |

state:表示人脸当前的状态,主要包括以下几种情况:

表 1-11

| 人脸状态(state)        | code | 说明          |
|--------------------|------|-------------|
| FACE_STATE_NORMAL  | 0    | 检测到人脸       |
| FACE_STATE_NOFACE  | 1    | 未检测到人脸      |
| FACE_STATE_TOOUP   | 2    | 人脸太靠近图片上边沿, |
|                    |      | 未能录入        |
| FACE_STATE_TOODOWN | 3    | 人脸太靠近图片下边沿, |
|                    |      | 未能录入        |
| FACE_STATE_TOOLEFT | 4    | 人脸太靠近图片左边沿, |

![](_page_8_Picture_1.jpeg)

|                                   |    | 未能录入        |
|-----------------------------------|----|-------------|
| FACE_STATE_TOORIGHT               | 5  | 人脸太靠近图片右边沿, |
|                                   |    | 未能录入        |
| FACE_STATE_FAR                    | 6  | 人脸距离太远,未能录入 |
| FACE_STATE_CLOSE                  | 7  | 人脸距离太近,未能录入 |
| FACE_STATE_EYEBROW                | 8  | 眉毛遮挡        |
| _OCCLUSION<br>FACE_STATE_EYE_OCCL | 9  | 眼睛遮挡        |
| USION                             |    |             |
| FACE_STATE_FACE_OCC               | 10 | 脸部遮挡        |
| LUSION                            |    |             |
| FACE_STATE_DIRECTION              | 11 | 录入人脸方向错误    |
| _ERROR                            |    |             |

s\_note\_data\_face 中其它成员的具体含义如下所示:

left:人脸框距离图片最左侧的距离(负数表示人脸框已超出图片最左侧) top:人脸框距离图片最上方的距离(负数表示人脸框已超出图片上方) right:人脸框距离图片最右侧的距离(负数表示人脸框已超图片最右侧) bottom:人脸框距离图片最下方的距离(负数表示人脸框已超出图片最下

#### 方)

yaw,pitch,roll 表示的旋转方向分别如下图所示。其中 yaw 为负表示左转 头,yaw 为正表示右转头;pitch 为负表示向上抬头,pitch 为正表示向下低头; roll 为负表示向右歪头,roll 为正表示向左歪头。

![](_page_8_Picture_7.jpeg)

![](_page_9_Picture_1.jpeg)

#### (2) IMAGE 消息的发送

模组向主控发送的 IMAGE 消息的完整协议如表 1-11 所示。模组传输图片时,一帧数据最大 支持 4000 字节数据的传输。

表 1-12

| 名称  | SyncWord | MsgID Size              |             | Data | ParityCheck |          |
|-----|----------|-------------------------|-------------|------|-------------|----------|
| 字节数 | 2 bytes  | 1 byte                  | 2 bytes     |      | N bytes     | 1 byte   |
| 内容  | 0xEFAA   | MID_I<br>MAGE<br>(0x02) | 高<br>八<br>位 | 低八位  | image data  | checksum |

## <span id="page-9-0"></span>1.5. 上下电流程

主控主动控制模组的上电和下电,如图 1-1 所示。模组上电即进入启动流程, 启动进入 standby 状态会通知主控 MSG::NOTE::READY, 主控开始发送命令消息,模组处理并返回结果。无消息发送时,主控调用

MSG::POWERDOWN,模组做处理返回,主控可断电。

图1-1

![](_page_9_Figure_10.jpeg)

![](_page_10_Picture_1.jpeg)

## <span id="page-10-0"></span>**1.6.** 主控接收消息流程

主控接收模组发送的消息可以遵循图1-2所示流程。

![](_page_10_Figure_4.jpeg)

## <span id="page-10-1"></span>**1.7.** 一般消息处理流程

![](_page_10_Figure_6.jpeg)

![](_page_11_Picture_1.jpeg)

## <span id="page-11-0"></span>**1.8.** 录入流程

![](_page_11_Figure_3.jpeg)

## <span id="page-11-1"></span>**1.9.** 解锁流程

![](_page_11_Figure_5.jpeg)

## <span id="page-11-2"></span>**1.10.** 加密通信流程

模组和主控间通讯必须采用加密通讯,加密通信流程如图 1-6 所示。

- ① 主控给模组上电;
- ② 模组发送 NOTE READY(明文)给主控;
- ③ 主控给模组第一次上电开机需发送 MID\_SET\_RELEASE\_ENC\_KEY(明文)指 令设置 16 Bytes 序列,后续上电不需再次发送。
- ④ 主控发送 MID\_INIT\_ENCRYPTION (明文)携带 4 Bytes 随机序列、加密模式给 模组;
- ⑤ 模组和主控双方根据这随机序列,采用自定义的私有协议生成 16 Bytes 的密 码。双方采用相同算法生成相同的密码。之后双方本次会话都采用此密码加解密;
- ⑥ 模组返回状态并采用随机密码 AES/SMPL 加密发送产品序列号给主控;

![](_page_12_Picture_1.jpeg)

- ⑦ 主控解密,鉴别设备 ID 确认身份后开始处理需求指令,录入或解锁等;
- ⑧ 主控采用随机生成的密码,AES/SMPL 加密的方式对指令和数据加密并发送给 模组;
- ⑨ 模组用第 4 步解密出来的密码解密,判断指令合法性并处理该指令;
- ⑩ 模组用第 4 步解密出来的密码对指令处理结果和数据加密,并发送给主 控。

![](_page_12_Figure_7.jpeg)

## **1.11. OTA** 升级流程

- <span id="page-12-0"></span>① 主控发送 MID\_START\_OTA(密文)通知模组进入 OTA 模式;
- ② 模组反馈 OK(明文,后续都是明文模式),模组进入 OTA 模式;
- ③ 主控发送 MID\_CONFIG\_BAUDRATE 配置更高的波特率,模组反馈 OK 后,主机同步设置相同波特率。延时 100ms 后才能开始串口数据传输。 (该配置过程可选,波特率默认是 115200)
- ④ 主控发送 MID\_OTA\_HEADER,把固件相关信息发送给模组;

![](_page_13_Picture_1.jpeg)

- ⑤ 模组反馈 OK:
- ⑥ 主控发送 MID GET OTA STATUS;
- ⑦ 模组反馈 OTA 状态和起始包序号;
- ⑧ 主控循环发送升级包 MID OTA PACKET, 收到 OK 后,继续下一包。
- ⑨ 模组收完固件后,开始升级。
- ⑩ 模组升级结束后,给主控反馈携带升级结果的 NOTE 信息(NID\_OTA\_DONE),10 秒后模组自动重启。主控发送完升级包后等待模组回复 NID\_OTA\_DONE 信息的超时时间须大于 120 秒。

## <span id="page-13-0"></span>1.12. 补充说明

## <span id="page-13-1"></span>1.12.1.设置加密规则 MID SET RELEASE ENC KEY

- 功能说明: 主控和模组之间须采用加密通讯,该指令和MID\_INIT\_ENCRYPTION 两个指令配合共同生成加密密钥。该指令传入的数据模组会保存,掉电不丢失。
- 输入参数: s msg enc key number data
- 返回参数:无指令代码:52H
- 指令包格式:

| SymaWard | SyncWord MsgID | Si                            | ze | Data        | ParityCheck |
|----------|----------------|-------------------------------|----|-------------|-------------|
| Syncword | Misgid         | H L s_msg_enc_key_number_data |    | TarityCheck |             |
| EFAA     | 52H            | 001                           | 0H | XXXX        | xxH         |

设置 Release Key 指令携带的数据 s msg enc key number data 定义如下

```
typedef struct {
    uint8_t enc_key_number[16];  // 00 ~ 1F
} s_msg_enc_key_number_data;
```

- 指令包示例: EFAA 52 0010 000102030405060708090A0B0C0D0E0F 42
- 应答包格式:

| SyncWord | MsgID | Si    | ze |     |        | Domity/Chools |             |
|----------|-------|-------|----|-----|--------|---------------|-------------|
|          |       | Н     | L  | mid | result | data          | ParityCheck |
| EFAA     | 00H   | 0002H |    | 52H | xxH    | 无             | xxH         |

注: result=00H(MR\_SUCCESS) 表示设置 KEY 成功; result=01H(MR\_REJECTED) 表示 KEY 曾经已设置过; result=06H(MR FAILED4 INVALIDPARAM) 表示传入的参数错误

![](_page_14_Picture_1.jpeg)

## <span id="page-14-0"></span>1.12.2.进入加密模式 MID\_INIT\_ENCRYPTION

- 功能说明:该指令和 1.12.1 MID\_SET\_RELEASE\_KEY 两个指令配合共同生成加密密钥,并采用设定的加密模式进行加密通讯。模组收到该指令后模组进入加密模式,将模组的 SN 号进行加密后回复给主控。主控收到数据采用相同的密钥、相同解密方式解密后得到明文数据。
- 输入参数: s msg init encryption data v2
- 返回参数:无
- 指令代码: 50H
- 指令包格式:

|      |      | Si  | ze     |         |       | Data           |                  |          |        |  |
|------|------|-----|--------|---------|-------|----------------|------------------|----------|--------|--|
| Cyma | Mag  |     |        |         | s_msg | _init_encrypti | cryption_data_v2 |          |        |  |
| Sync | Msg  | Н   | T      | seed[4] | mode  | crttime[4]     | power_           | reserved | Parity |  |
| Word | ID   | 11  |        |         |       |                | mode             |          | Check  |  |
| EFAA | 50H  | 000 | )9H    | xxxx    | XX    | XXXX           | /                | /        | xxH    |  |
| LIAA | 3011 |     | ,,,,,, | xxxx    | AA    | XXXX           | ,                | ,        | AAII   |  |

#### ● 参数说明:

- 1) seed: 随机数,用于生成加密密钥使用;
- 2) mode: 加密模式。AES 加密: 01H, 简单加密模式: 02H
- 3) crttime: 用于同步模组和主控的系统时间,该数组存储的内容代表当前时区的秒数(1970年至今)
- 4) power mode: 预留参数
- 5) reserved[2]: 预留参数

指令中携带参数 s msg init encryption data v2 结构体定义如下:

```
typedef struct {
    uint8_t seed[4];
    uint8_t mode; uint8_t
    crttime[4]; uint8_t
    power_mode; uint8_t
    reserved[2];
} s_msg_init_encryption_data_v2;
```

![](_page_15_Picture_1.jpeg)

## ● 指令包示例

EFAA 50 0009 3C56B385 01 5E689A73 DB

#### 指令释义:

随机数 seed 为 3C56B385; 采用 AES 加密模式(01); 时间戳 crtime 为 5E689A73。seed 的 md5 为 ee71535357ad9bb47cb6e1ba638c26a6,根据 MID\_SET\_RELEASE\_ENC\_KEY 设置的密钥规则,最终生成的加解密密钥为 ee71535357ad9bb4。

#### ● 应答包格式:

| a w 1    | Si  | ze  | Data  | Parity |
|----------|-----|-----|-------|--------|
| SyncWord | Н   | L   | 密文    | Check  |
| EFAA     | 00x | кхН | xxxxH | xxH    |

#### ● 应答包示例:

EF AA 0020 B9 87 85 D6 D6 D1 A6 72 B6 A4 21 B7 AD 7E 0F 98 83 BA 62 5B 52 83 50 2C C7 4A F9 AE 2C 2F 84 03 8D

0020 为应答包中加密数据的长度 size,粗体部分为模组回复的加密数据,主控对粗体部分数据进行解密得到下表中明文数据: 00 0016 50 00 43 4F 42 41 31 33 38 39 30 31 32 34 30 37 38 39 33 32 31 即该模块的 SN: COBA138901240789321。即:模组加密的消息体为:明文指令中的 Size 和 Data 部分,主控加密操作也是类似。

|              | Size    |     |           |     |       | Data                                        |        |
|--------------|---------|-----|-----------|-----|-------|---------------------------------------------|--------|
| Sync<br>Word | Msg ID  |     |           |     |       | data                                        | Parity |
| Word         | Wisg ID | Н   | L         | mid | resul | s_msg_reply_init_encryption_data            | Chec   |
|              |         |     |           |     |       | device_id[20]                               |        |
| EFAA         | 00Н     | 001 | 0016Н 50Н |     | 00Н   | 434F4241313338393031323<br>430373839 333231 | xxH    |

## <span id="page-15-0"></span>1.12.3. 待机指令 MID RESET

● 功能说明:主控发送这条命令后,模组将终止正在执行的命令(例如录入、解锁等),返回待机状态。

• 输入参数:无• 返回参数:无• 指令代码: 10H

● 指令包格式:

| SyncWord | MsgID | Size |     |      | Donity Chools |
|----------|-------|------|-----|------|---------------|
|          |       | Н    | L   | Data | ParityCheck   |
| EFAA     | 10H   | 000  | 00H | 无    | 10H           |

![](_page_16_Picture_1.jpeg)

● 指令包示例: EFAA 10 0000 10

● 应答包格式:

| a w 1    | 14 m  | Si    | ze |     | D : G1 1 |      |             |
|----------|-------|-------|----|-----|----------|------|-------------|
| SyncWord | MsgID | Н     | L  | mid | result   | data | ParityCheck |
| EFAA     | 00Н   | 0002H |    | 10H | xxH      | /    | xxH         |

● 应答包示例:

EF AA 00 00 02 10 00 12

<span id="page-16-0"></span>注: result=00H 表示执行成功; 其他为失败。

## 1.12.4.获取模组状态 MID\_GETSTATUS

● 功能说明: 主控发送该命令后,模组返回自身当前的状态。

● 输入参数:无

● 返回参数: s\_msg\_reply\_getstatus\_data

● 指令代码: 11H

● 指令包格式:

| SyncWord | Masin | Siz   | e | Data            | ParityCheck |  |
|----------|-------|-------|---|-----------------|-------------|--|
| Syncword | MsgID | Н     | L | Data ParityChec | ParityCheck |  |
| EFAA     | 11H   | 0000Н |   | 无               | 11H         |  |

● 指令包示例: EFAA 11 0000 11

● 应答包格式:

|              |           | Si  | ze  |     | Data    |                                        |              |  |  |  |
|--------------|-----------|-----|-----|-----|---------|----------------------------------------|--------------|--|--|--|
| Sync<br>Word | Msg<br>ID | Н   | L   | mid | result  | data s_msg_reply_getstatus_data status | Parity Check |  |  |  |
| EFAA         | 00H       | 000 | )3H | 11H | xxH xxH |                                        | xxH          |  |  |  |

应答包携带数据 s\_msg\_reply\_getstatus\_data 结构体定义如下:

![](_page_17_Picture_1.jpeg)

```
typedef struct {
    uint8_t status;
} s_msg_reply_getstatus_data;
```

● 应答包示例:

EF AA 00 0003 11 00 00 12

注: status=00H, MS\_STANDBY 模组处于空闲状态,等待主控命令; status=01H, MS\_BUSY 模组处于工作状态; status=02H, MS\_ERROR 模组出错,不能正常工作; status=03H, MS\_INVALID 模组未进行初始化。

## <span id="page-17-0"></span>1.12.5.识别 MID\_VERIFY

● 功能说明: 主控发送该指令给模组,模组开始识别人脸进行比对

● 输入参数: s msg verify data

● 返回参数: s\_msg\_note\_data 、s\_msg\_reply\_verify\_data

● 指令代码: 12H

● 指令包格式:

|          |         | Size |     | Data              |         |                  |
|----------|---------|------|-----|-------------------|---------|------------------|
| SyncWord | MsgID   | **   | _   | s_msg_verify_data |         | ParityCheck      |
|          | 1112812 | H L  |     | pd_rightaway      | timeout | 2 02209 0 220022 |
| EFAA     | 12H     | 000  | )2H | 00                | xxH     | xxH              |

```
// verify typedef

struct {

    uint8_t pd_rightaway; // power down right away after verifying

    uint8_t timeout; // timeout, unit second, default 10s
} s_msg_verify_data;
```

识别指令携带数据 s msg verify data 定义如下:

- 识别指令参数说明:
  - 1) pd rightaway 表示是否在解锁后立刻关机(预留参数),默认设 00;
  - 2) timeout 为解锁超时时间(单位 s), 默认 10s, 超时时间用户可自行设定,最大不超过 255s。主控等待模组应答包超时时间应大于该参数设置值。

![](_page_18_Picture_1.jpeg)

● 应答包格式:

解锁过程中,模组应答 NOTE 和 REPLY 两种消息。一次识别过程中模组可能会应答多条 NOTE(MSGID=01H)来表示当前图像帧的人脸状态、位置和姿态,但最终只有一个 REPLY(MSGID=00H)来表示该次识别的最终结果。

● 应答 NOTE 消息格式:

|      |     |    |         |     |       |                                            |    | Dat     | a        |  |  |  |  |  |
|------|-----|----|---------|-----|-------|--------------------------------------------|----|---------|----------|--|--|--|--|--|
|      |     | Sı | ze      |     |       |                                            | s_ | _msg_nc | ote_data |  |  |  |  |  |
| Sync | Msg |    |         |     |       | data                                       |    |         |          |  |  |  |  |  |
|      |     | Н  | L       | nid |       | s_note_data_face                           |    |         |          |  |  |  |  |  |
| Word | ID  |    |         |     | state | state left top right bottom yaw pitch roll |    |         |          |  |  |  |  |  |
| EFAA | 01H |    | кх<br>Н | xxH |       | XXXX XXXX XXXX XXXX XXXX XXXX XXXX         |    |         |          |  |  |  |  |  |

注: nid=01H 表示 NID\_FACE\_STATE, 表示模组返回的数据为当前帧的人 脸状态;

NOTE 消息中携带的 s note data face 结构体定义如下:

```
typedef struct {
    int16_t state; // corresponding to FACE_STATE_*

// position
    int16_t left; // in pixel
    int16_t top;
    int16_t right;

    int16_t bottom;

// pose

int16_t yaw; // up and down in vertical orientation
    int16_t pitch; // right or left turned in horizontal orientation
} s_note_data_face;
```

s 表示当前人脸状态 state,两个字节,**低字节在前,高字节在后**; state 的定义见表 1-11:

1、t、r、b 分别表示人脸的在图像中的位置,分别为左 left、上 top、右 right、下 down,两个字节,低字节在前,高字节在后;

y、p、R 表示人脸的姿态,分别为偏航角 yaw、俯仰角 pitch、翻滚角

![](_page_19_Picture_1.jpeg)

roll,两个字节,低字节在前,高字节在后:应答 NOTE 消息示例:

● 应答 NOTE 消息示例:

EFAA 01 0011 01 0700 00 00 00 00 00 00 00 00 00 00 00 0

● 识别指令 REPLY 消息格式:

|      |      | Si  | ze   |      |        | Da      | ta                      |        |        |        |
|------|------|-----|------|------|--------|---------|-------------------------|--------|--------|--------|
| Symo | Mag  |     |      |      |        |         | da                      | ıta    |        | Parity |
| Sync | Msg  | Н   | L    | mid  | result | S_1     | s_msg_reply_verify_data |        |        |        |
| Word | ID   |     |      |      |        | aan id  | user_                   | admin  | unlock | Check  |
|      |      |     |      |      |        | user_id | name                    | admin  | Stauts |        |
|      |      |     |      |      |        |         |                         |        | States |        |
| EFAA | 00H  | 002 | 26H  | 10H  | xxH    | XXXX    | XX                      | xxH    | xxH    | xxH    |
|      | 0011 | 302 | 2011 | 1011 | 7,7,11 | xxxx    | XX                      | 7.7.11 | AAII   | AAII   |

- 识别指令 REPLY 应答包参数说明:
  - 1) user id: 识别成功的用户 ID;
  - 2) user name: 识别成功的用户名字;
  - 3) admin: 识别成功的用户是否为管理员用户;
  - 4) unlockStatus: 识别成功时的人眼状态(保留参数); 识别成功 s msg reply verify data 结构体定义如下:

```
typedef struct {
    uint8_t user_id_heb;
    uint8_t user_id_leb;
    uint8_t user_name[USER_NAME_SIZE]; // 32Bytes
    uint8_t admin;
    uint8_t unlockStatus;
} s_msg_reply_verify_data;
```

- 识别返回结果 result 确认码的返回值见表 1-7
- 识别指令包示例:

EFAA 00 0026 12 00 **0001** 

000000000000000000000000000000000000

EF AA 00 0002 12 0D 1D

指令释义: 识别结果 0D, 超时时间到, 识别失败。

![](_page_20_Picture_1.jpeg)

## <span id="page-20-0"></span>1.12.6.录入指令

- 功能说明:录入指令集中有三个录入指令。
  - 1) 单帧录入 MID\_ENROLL\_SINGLE, 该指令只录入一张正脸即可, 同一张人脸可以录入多次, 生成不同的人脸 ID:
  - 2) 交互式录入 MID\_ENROLL,该指令需录入上下左右中五个方向的人脸才完成一次录入生成一个人脸 ID;同一张人脸可录入多次;
  - 3) 综合录入 MID\_ENROLL\_ITG,该指令综合了单帧录入和交互式录入两种录入方式,通过传参形式控制录入方式以及同一张人脸是否可以重复录入。

## 1.12.6.1. 单帧录入 MID\_ENROLL\_SINGLE

● 功能说明:单帧录入,仅录入正向人脸即可

● 输入参数: s msg enroll data

● 返回参数: s msg reply enroll data

● 指令代码: 1DH

● 指令包格式:

|          |         | Si  | ze  |       | I      | Data        |         |        |
|----------|---------|-----|-----|-------|--------|-------------|---------|--------|
| SyncWord | MsgID   |     | Į.  |       | s_msg_ | enroll_data |         | Parity |
| Syneword | IVISGID | H   | L   | admin | name   | direction   | timeout | Check  |
| EFAA     | 1DH     | 002 | 23H | 00H   | xxxx   | xxH         | xxH     | xxH    |

单帧录入指令携带参数 s msg enroll data 定义如下:

```
typedef struct {
    uint8_t admin; // the user will be set to admin
    uint8_t user_name[32];
    s_face_dir face_direction; // depleted, user ignore this field
    uint8_t timeout;
} s_msg_enroll_data;
```

- 参数说明:
  - 1) admin:设置改录入的人为管理员; 2) user name:录入用户的用户名;
  - 3) face direction: 无效参数,可设置为 00;

![](_page_21_Picture_1.jpeg)

- 4) timeout: 录入过程的超时时间(单位 s), 默认为 10s, 用户可以随意设置,最大不超过 255s。主控等待模组录入应答的超时时间应大于此参数设置值。
- 单帧录入指令包示例:

EFAA 1D 0023 00

00000000000000000000000000000000000000

指令释义:设置录入的用户为普通用户 admin(00),用户名为 0,人 脸方向为 0,超时时间为 10(0A)秒。

● 应答包格式:

录入过程中同样也会返回 NOTE 和 REPLY 两种应答消息。NOTE 同 MID VERIFY 指令中 NOTE 相关说明。

|      |     | Siz | ze |     |        | Data     |                  |        |
|------|-----|-----|----|-----|--------|----------|------------------|--------|
| Sync | Msg |     |    |     |        |          | Data             | Parity |
| Word | ID  | Н   | L  | mid | result | s_msg_re | eply_enroll_data | Check  |
|      |     |     |    |     |        | user_id  | face_direction   |        |
| EFAA | 00H | 000 | 5H | 1DH | xxH    | xxxxH    | 00H              | xxH    |

录入结果 result 确认码的返回值见表 1-7 单帧录入成功模组返回数据 s msg reply enroll data 定义如下:

```
typedef struct {
    uint8_t user_id_heb;
    uint8_t user_id_leb;
    uint8_t face_direction; // depleted, user ignore this field
} s_msg_reply_enroll_data;
```

注: 其中用户 ID 每次录入都会增加 1,即使删除某个 ID 后,再次录入 ID 会继续增加,直至 65530, ID 变为 0。

● 单帧录入应答包指令示例:

EFAA 00 0005 1D 00 0003 00 1B, 识别成功 00, 识别成功的用户ID 为 0003,

EFAA 00 0005 1D 08 10, 识别失败, 失败原因为该用户未录入 (08H)

## 1.12.6.2. 交互式录入 MID\_ENROLL

- 功能说明:交互式录入,完成上中下左右 5 个方向的录入,最终生成一个人脸 ID
- 输入参数: s msg enroll data

![](_page_22_Picture_1.jpeg)

- 返回参数: s\_msg\_reply\_enroll\_data
- 指令代码: 13H
- 指令包格式:

表 1-12-7-1 交互式录入指令包格式

| 77 - 32 / 5 / 5 / 5 / 6 / 7 / 6 / 6 / 6 / 6 / 6 / 6 / 6 / 6 |       |    |     |        |          |            |         |              |  |  |  |
|-------------------------------------------------------------|-------|----|-----|--------|----------|------------|---------|--------------|--|--|--|
|                                                             |       | S  | ize |        | Da       | ata        |         |              |  |  |  |
|                                                             |       |    |     |        | s_msg_er | nroll_data |         | Domitra      |  |  |  |
| SyncWord                                                    | MsgID | Н  | L   | admin  | name     | direction  | timeout | Parity Check |  |  |  |
|                                                             |       |    |     | 1 Byte | 32 Bytes | 1 Byte     | 1 Byte  |              |  |  |  |
| EFAA                                                        | 13H   | 00 | 23H | 00H    | xxxx     | xxH        | xxH     | xxH          |  |  |  |

交互式录入指令携带参数 s msg enroll data 定义如下:

```
typedef struct {
    uint8_t admin; // the user will be set to admin
    uint8_t user_name[32];
    s_face_dir face_direction; // depleted, user ignore this field
    uint8_t timeout;
} s_msg_enroll_data;
```

#### ● 参数说明:

- 5) admin: 设置改录入的人为管理员;
- 6) user name: 录入用户的用户名;
- 7) face\_direction: 当前录入的人脸方向; face\_direction=10H(FACE\_DIRECTION\_UP),表示当前录入朝上的人脸方向; face\_direction=08H(FACE\_DIRECTION\_DOWN),表示录入朝下的人脸方向; face\_direction=04H(FACE\_DIRECTION\_LEFT),表示录入朝左的人脸方向; face\_direction=02H(FACE\_DIRECTION\_RIGHT),表示录入朝右人脸方向; face\_direction=01H(FACE\_DIRECTION\_MIDDLE),表示录入居中人脸方向; face\_direction的低5位从高到低分别表示人脸方向的朝上、朝下、朝左、朝右和正向,如下图所示,1表示该朝向已录入,0表示该朝向未录入

![](_page_22_Picture_13.jpeg)

![](_page_23_Picture_1.jpeg)

- 8) timeout: 录入过程的超时时间(单位 s), 默认为 10s, 用户可以随意设置, 最大不超过 255s。主控等待模组录入应答的超时时间应大于等于此参数 设置值。
- 交互式录入应答包格式:

|      |     | Siz | ze |     |        | Data     |                         |        |
|------|-----|-----|----|-----|--------|----------|-------------------------|--------|
| Sync | Msg |     |    |     |        |          | Data                    | Parity |
| Word | ID  | Н   | L  | mid | result | s_msg_re | s_msg_reply_enroll_data |        |
|      |     |     |    |     |        | user_id  | face_direction          |        |
| EFAA | 00H | 000 | 5H | 13H | xxH    | xxxxH    | xxH                     | xxH    |

● 交互式录入指令包&应答包示例:

应答包同单帧 MID\_ENROLL\_SINGLE, NOTE 和 REPLY 两种。按照中右左下上的顺序录入一个普通用户,参考指令如下:

#### ① 录入中间方向指令:

EFAA 13 0023 00

000000000000000000000000000000000000

000000 01 05 34

录入中间方向 REPLY 应答包:

EFAA 00 0005 13 00 FFFF 01 17

中间方向录入成功,face\_direction=0000 0001(BIN),最后 1 位置 1 表示已录入中间一个方向。

#### ② 录入右向指令:

EFAA 13 0023

000000000000000000000000000000000000

00000000 02 05 37

录入右向 REPLY 应答包:

EFAA 00 0005 13 00 FFFF 03 15

右向录入成功, face\_direction=0000 0011(BIN), 后两位置 1 表示已经录入中间和右两个方向。

#### ③ 录入左向指令:

EFAA 13 0023

000000000000000000000000000000000000

00000000 04 05 31

录入左向 REPLY 应答包:

EFAA 00 0005 13 00 FFFF 07 11

右向录入成功, face\_direction=0000 0111(BIN), 后三位置 1 表示已经录入中间、右、左三个方向。

#### ④ 录入下向指令:

EFAA 13 0023

000000000000000000000000000000000000

00000000 08 05 3D

![](_page_24_Picture_1.jpeg)

录入下向 REPLY 应答包:

EFAA 00 0005 13 00 FFFF 0F 19

右向录入成功, face\_direction=0000 1111(BIN), 后四位置 1 表示已经录入中间、右、左、下四个方向。

#### ⑤ 录入上向指令:

EFAA 13 0023

000000000000000000000000000000000000

00000000 10 05 25

录入向上 REPLY 应答包:

EFAA 00 0005 13 00 0003 1F 0A

右向录入成功, face\_direction=0001 1111(BIN), 后五位置 1 表示已经录入中间、右、左、下、上五个方向, 并生成有效的 ID 0003。

## 1.12.6.3. 综合录入指令 MID\_ENROLL\_ITG

- 功能说明:该指令是集成了单帧录入指令 MID\_ENROLL\_SINGLE、交互录入指令 MID\_ENROLL 等多种录入方式, 录入方式可以在参数结构中指定,并可控制同一张人脸是否能够重复录入;
- 输入参数: s msg enroll itg
- 返回参数: s\_msg\_reply\_enroll\_data
- 指令代码: 26H
- 指令包格式:

表 1-13-6-1 单帧录入指令包格式

|      |     | Si  | ze  |                                | Data             |           |         |           |         |             |     |  |  |  |
|------|-----|-----|-----|--------------------------------|------------------|-----------|---------|-----------|---------|-------------|-----|--|--|--|
| Sync | Msg |     |     |                                | s_msg_enroll_itg |           |         |           |         |             |     |  |  |  |
| Word | ID  | Н   | L   | admin                          | name             | face_     | enroll_ | enable_   | timeout | reserved[3] |     |  |  |  |
|      |     |     |     |                                |                  | direction | type    | duplicate |         |             |     |  |  |  |
| EFAA | 26H | 002 | 25H | xxH xxH xxH xxH xxH xxH xx xxH |                  |           |         |           |         |             | ххН |  |  |  |

ITG 综合录入指令携带参数 s msg enroll itg 结构体定义如下:

![](_page_25_Picture_1.jpeg)

```
typedef struct {
   uint8_t admin; // the user will be set to admin, 1:admin user, 0:normal user
   uint8_t user_name[USER_NAME_SIZE]; // 32Bytes
   uint8_t face_direction;
   uint8_t enroll_type;
   uint8_t enable_duplicate; // enable user enroll duplicatly, 1:enable, 0:disable
    uint8_t timeout;
    uint8_t reserved[3];
} s_msg_enroll_itg;
                        // timeout unit second default 10s
                       // reserved field
```

## ⚫ 参数说明

- 1) admin:控制该录入用户是否为管理员用户;
- 2) user\_name:录入用户的用户名;
- 3) enroll\_type:采用的录入方式,0 表示交互式上中下左右 5 个方向的录 入方式、1 表示单帧录入方式;
- 4) face\_direction:采用单帧录入时,参数无效,可以使用 0;采用交互式录 入方式可参考交互式录入 MID\_ENROLL 指令中的说明;
- 5) enable\_duplicate:0 表示同一个人不能重复录入,1 表示同一个人脸能够 多次录入;username 都可以重复。
- 6) timeout:录入过程的超时时间(单位 s),默认为 10s,用户可以随意设置, 最大不超过 255s。主控等待模组录入应答的超时时间应大于等于此参数设置值。
- ⚫ 指令包示例:

EFAA 26 0025 00

0000000000000000000000000000000000000000000000000000000000

000000 00 01 00 05 07,采用单帧录入(01)方式录入一个名为 0 的普通用户,不能 重复录入(00)。

- ⚫ 应答包格式同 MID\_ENROLL\_SINGLE/MID\_ENROLL
- ⚫ 应答包示例:

EF AA 00 00 05 26 00 0004 00 27

EF AA 00 00 02 26 0A 2E

设置成不能重复录入时,成功录入一张人脸,ID 为 0004,再次录入该人脸模组反 馈 MR\_FAILED4\_FACEENROLLED(0A),错误码 见表 1-7。

![](_page_26_Picture_1.jpeg)

## <span id="page-26-0"></span>1.12.7.清除人脸录入状态 MID\_FACERESET

● 功能说明: 重置 SDK 算法状态,如果正在进行交互式录入 MID\_ENROLL,发送该指令会重置录入的状态,已录入的方向 全部被清空。

输入参数:无返回参数:无指令代码:23H

● 指令包格式

| CW1 MID  |       | Si    | ze | D-4- | D = -11-    |  |
|----------|-------|-------|----|------|-------------|--|
| SyncWord | MsgID | Н     | L  | Data | ParityCheck |  |
| EFAA     | 23H   | 0000Н |    | 无    | xxH         |  |

#### ● 应答包格式:

| SyncWord  | MsgID  | Si  | ze |     | Data   |      | ParityCheck   |
|-----------|--------|-----|----|-----|--------|------|---------------|
| Syne word | Wisgib | Н   | L  | mid | result | data | 1 arity check |
| EFAA      | 00H    | 000 | 2H | 23Н | xxH    | 无    | xxH           |

注: result=00H(MR\_SUCCESS) 删除成功; result=08H(MR\_FAILED4\_UNKNOWNREASON) 未知错误;

## <span id="page-26-1"></span>1.12.8.删除单个用户 MID DELUSER

● 功能说明:通过传入用户 ID, 删除指定 ID 的单个用户

● 输入参数: s msg deluser data

返回参数:无指令代码: 20H指令包格式:

| 76 Y — 18 Y |           |           |      |    |                   |             |        |  |
|-------------|-----------|-----------|------|----|-------------------|-------------|--------|--|
|             |           |           | Size |    | I                 | Data        |        |  |
|             | SyncWord  | MsgID     |      | Į. | s_msg_enroll_data |             | Parity |  |
|             | zyne wara | 1,110,512 | H    | L  | user_id_heb       | user_id_leb | Check  |  |
|             | EFAA      | 20H       | 000  | 2H | xxH               | xxH         | xxH    |  |

删除单个用户指令携带参数 s\_msg\_deluser\_data 定义如下:

![](_page_27_Picture_1.jpeg)

```
typedef struct {
    uint8_t user_id_heb;
    uint8_t user_id_leb;
} s_msg_deluser_data;
```

● 删除单个用户指令包示例: EFAA 20 0002 0006 24 指令释义: 删除 ID 为 0006 的人脸用户

● 应答包格式:

| SyncWord   | MsgID  | Si  | ze |     | Data   |      | ParityCheck |
|------------|--------|-----|----|-----|--------|------|-------------|
| Sylic Word | Wisgib | H L |    | mid | result | data | Tantycheck  |
| EFAA       | 00H    | 000 | 2H | 20H | xxH    | 无    | xxH         |

注: 主控等待应答超时时间建议设置为 5 秒。
result=00H(MR\_SUCCESS) 删除成功;
result=05H(MR\_FAILED4\_UNKNOWNREASON) 未知错误;
result=08H(MR\_FAILED4\_UNKNOWNUSER) 删除的 ID 不存在;

## <span id="page-27-0"></span>1.12.9.删除所有用户 MID\_DELALL

● 功能说明:删除所有已注册的用户

輸入参数: 无返回参数: 无指令代码: 21H指令包格式:

| G W 1    | ) ( T | Si  | ze  | 5    | D 1 01 1    |
|----------|-------|-----|-----|------|-------------|
| SyncWord | MsgID | Н   | L   | Data | ParityCheck |
| EFAA     | 21H   | 000 | 00H | 无    | xxH         |

● 删除所有用户指令示例: EFAA 21 0000 21

● 应答包格式:

|          |       | Si  | ze  |     | Data   |      | n : at 1    |
|----------|-------|-----|-----|-----|--------|------|-------------|
| SyncWord | MsgID | Н   | L   | mid | result | data | ParityCheck |
| EFAA     | 00H   | 000 | )2H | 21H | xxH    | 无    | xxH         |

![](_page_28_Picture_1.jpeg)

● 删除所有用户应答示例:

EFAA 00 0002 21 00 23, 成功删除所有人脸用户

EF AA 00 00 02 21 05 26,未录入过人脸的全新模组,模组内未生成人脸模板文件,导致删除失败。或出现其他的未知错误导致删除失败。

注: result=00H(MR\_SUCCESS) 删除成功; result=05H(MR FAILED4 UNKNOWNREASON) 未知错误;

## <span id="page-28-0"></span>1.12.10. 获取指定 ID 的用户信息 MID\_GETUSERINFO

● 功能说明: 主控通过 user id 指定要返回的注册用户,模组接收到 该命令后会返回指定用户的信息

● 输入参数: s msg getuserinfo data

返回参数:无指令代码:22H

● 指令包格式:

|           |          | Si  | ze  | D           | ata           |         |
|-----------|----------|-----|-----|-------------|---------------|---------|
| SyncWord  | MsgID    |     | Į.  | s_msg_geti  | userinfo_data | ParityC |
| Syne word | 1,10,512 | Н   | L   | user_id_heb | user_id_leb   | heck    |
| EFAA      | 22H      | 000 | )2H | xxH         | xxH           | xxH     |

获取指定 ID 的用户指令携带参数 s msg getuserinfo data 定义如下:

```
typedef struct {
    uint8_t user_id_heb; // high eight bits of user_id to get info
    uint8_t user_id_leb; // low eight bits of user_id to get info
} s_msg_getuserinfo_data;
```

#### ● 应答包格式:

|              |     | Si  | ze |     | Data   |         |                |       |        |
|--------------|-----|-----|----|-----|--------|---------|----------------|-------|--------|
| Sync         | Msg |     |    |     |        |         | Data           |       | Parity |
| Sync<br>Word | ID  | Н   | L  | mid | result | s_msg   | g_getuserinfo_ | _data | Check  |
|              |     |     |    |     |        | user_id | user_name      | admin |        |
| EFAA         | 00H | XXX | хН | 22H | xxH    | xxH     | xxxxH          | xxH   | xxH    |

成功获取指定 ID 的用户信息成功后,指令模组回复数据 s msg getuserinfo data 定义如下:

![](_page_29_Picture_1.jpeg)

```
typedef struct {
    uint8_t user_id_heb;
    uint8_t user_id_leb;
    uint8_t user_name[USER_NAME_SIZE]; // 32 Bytes
    uint8_t admin;
} s_msg_reply_getuserinfo_data;
```

注: result=00H(MR\_SUCCESS) 获取用户信息成功; result=05H(MR\_FAILED4\_UNKNOWNREASON) 未知错误; result=08H(MR\_FAILED4\_UNKNOWNUSER) 该 ID 不存在;

## <span id="page-29-0"></span>1.12.11. 获取已注册用户的 ID MID\_GET\_ALL\_USERID

● 功能说明: 获取所有已注册用户的数量和所有已注册用户的 ID。

● 输入参数:无

● 返回参数: s\_msg\_reply\_all\_userid\_data

● 指令代码: 24H

● 指令包格式:

| a w 1 w m |       | Si  | ze | 5    | D : C1 1    |  |
|-----------|-------|-----|----|------|-------------|--|
| SyncWord  | MsgID | Н   | L  | Data | ParityCheck |  |
| EFAA      | 24H   | 000 | ЮН | 无    | xxH         |  |

● 指令包示例: EFAA 24 0000 24

● 应答包格式:

|      |     | Si  | ze |     |        | Data                        |               |        |
|------|-----|-----|----|-----|--------|-----------------------------|---------------|--------|
| Sync | Msg |     |    |     |        | I                           | Data          | Parity |
| Word | ID  | Н   | L  | mid | result | s_msg_reply_all_userid_data |               | Check  |
|      |     |     |    |     |        | user_counts                 | users_id[100] |        |
| EFAA | 00Н | 002 | ВН | 24H | xxH    | xxH                         | XXXX          | xxH    |

#### ● 应答包示例:

EF AA 00 0067 24 00 03 0001 0002 0003 0000 0000 0000 000

![](_page_30_Picture_1.jpeg)

 $0000\ 0000\ 0000\ 0000\ 0000\ 0000\ 0000\ 0000\ 0000\ 0000\ 0000\ 0000$ 

指令释义:成功获取到模组已注册人脸个数 3 个,这 3 个人脸 ID 分别为 0001 0002 0003。

<span id="page-30-0"></span>模组最大可以注册 50 个 ID, 请注意主控端分配保存应答包数据的 buffer 大小。

## 1.12.12. 演示模式 MID DEMOMODE

- 功能说明:演示模式仅用于演示使用,安全性较低,任何人都可以解锁。掉电不保存,重启后模组恢复到正常模式。
- 输入参数: mode
- 返回参数:无
- 指令代码: FEH
- 指令包格式:

| a w 1    | 14 ID | Si  | ze  | Data | n : at 1    |
|----------|-------|-----|-----|------|-------------|
| SyncWord | MsgID | Н   | L   | mode | ParityCheck |
| EFAA     | FEH   | 000 | )1H | 01H  | FEH         |

● 指令报示例:

进入演示模式: EFAA FE 0001 01 FE 退出演示模式: EFAA FE 0001 00 FF

● 应答包格式:

| G W 1    | M ID           | Size |     |     | Data   |      |             |  |
|----------|----------------|------|-----|-----|--------|------|-------------|--|
| SyncWord | ncWord   MsgID |      | L   | mid | result | data | ParityCheck |  |
| EFAA     | 00H            | 000  | )2H | FEH | xxH    | 无    | xxH         |  |

● 应答包示例:

<span id="page-30-1"></span>EFAA 00 0002 FE 00 FC

## 1.12.13. 设置安全等级 MID\_SET\_THRESHOLD\_LEVEL

- 功能说明:修改算法安全等级,在不同厂商的与用户的理解中,对于安全的要求标准不一致,所以商汤开放安全等级接口,用于设置liveness和verify的安全等级,可设置四个等级低、较低、正常、较高、高。
- 输入参数: s msg algo threshold level
- 返回参数:无
- 指令代码: D4H

![](_page_31_Picture_1.jpeg)

#### ● 指令包格式:

|          |       | Si  | ze  | Da              | ata            |             |
|----------|-------|-----|-----|-----------------|----------------|-------------|
|          |       |     |     | s_msg_algo_thre | eshold_level   |             |
| SyncWord | MsgID | Н   | L   | verify_thresho  | liveness_thres | ParityCheck |
|          |       |     |     | ld_level        | hold_level     |             |
| EFAA     | D4H   | 000 | )2H | xxH             | xxH            | xxH         |

指令包携带数据 s msg algo threshold level 数据结构体定义如下:

```
typedef struct {
    uint8_t verify_threshold_level;
```

● 指令包示例:

EFAA D4 0002 04 03 D1

设置比对等级为较高等级,活体等级保持默认等级

● 应答包格式:

| G W 1    | ) ( ID | Size |     |     | D : C1 1 |      |             |
|----------|--------|------|-----|-----|----------|------|-------------|
| SyncWord | MsgID  | Н    | L   | mid | result   | data | ParityCheck |
| EFAA     | 00Н    | 000  | )2H | D4H | xxH      | 无    | xxH         |

● 应答包示例:

EFAA 00 0002 D4 00 D6

<span id="page-31-0"></span>声明:推荐使用默认设置,安全等级过高易导致通过率降低;安全等级过低易导致误识问题,请慎用该设置。

## 1.12.14. 图像抓拍

● 功能说明:图片抓拍,主控下达 MID\_SNAPIMAGE 指令,模组会立刻进行抓拍,将抓拍到的图片按照起始编号依次向后命名并存于本地 (jpg 格式)。最大支持本地存储的图片数量为 10 张,图片编号为 1-30。主控通过 MID\_GETSAVEDIMAGE 和 MID\_UPLOADIMAGE 指令获取抓拍的图像数据。

![](_page_32_Picture_1.jpeg)

## 1.12.14.1.图像抓拍 MID\_SNAPIMAGE

● 功能说明:图片抓拍,主控下达该指令,并携带需抓拍图片的数量以及抓拍图片的起始编号后,模组会立刻进行抓拍,将抓拍到的图片按照起始编号依次向后命名并存于本地(jpg 格式)。最大支持本地存储的图片数量为 10 张,图片编号为 1-30,当主控发送的编号与本地图片编号重复时,将覆盖原始图片。

● 输入参数: s msg snap image data

返回参数:无指令代码: 16H指令包格式:

|          |         | Size  |   | Da                    | ata          |             |
|----------|---------|-------|---|-----------------------|--------------|-------------|
| SyncWord | MsgID   | **    |   | s_msg_snap_image_data |              | ParityCheck |
|          | 1.12812 | Н     | L | image_counts          | start_number |             |
| EFAA     | 16H     | 0002H |   | xxH                   | xxH          | xxH         |

#### ● 参数说明:

1) image counts: 抓拍图像的数量;

2) start number: 抓取图像的名称编号。

● 指令包示例:

EFAA 16 0002 05 03 12, 抓取 5 张(05)图像,起始编号为 03,即保存图像名为: 3.jpg、4.jpg、5.jpg、6.jpg、7.jpg 的 5 张图像。 EFAA 16 0002 05 30 21, 抓取 5 张(05)图像,起始编号为 30,即保存图像名为: 30.jpg、1.jpg、2.jpg、3.jpg、4.jpg 的 5 张图像。

● 应答包格式:

| G W 1    | MsgID | Size |     |     | Data   |      |             |  |
|----------|-------|------|-----|-----|--------|------|-------------|--|
| SyncWord |       | Н    | L   | mid | result | data | ParityCheck |  |
| EFAA     | 00H   | 000  | )2H | 16H | xxH    | 无    | xxH         |  |

#### ● 应答包示例

EF AA 00 00 02 16 00 14

注: result=00H(MR\_SUCCESS) 抓取图像成功;
result=04H(MR\_FAILED4\_CAMERA) Camera 启动失败;
result=05H(MR\_FAILED4\_UNKNOWNREASON) 未知错误;
result=06H(MR\_FAILED4\_INVALIDPARAM) 指令包传参错误;
result=14H(MR\_FAILED4\_WRITE\_FILE) 写文件失败;

![](_page_33_Picture_1.jpeg)

## 1.12.14.2.获取抓拍图像大小 MID\_GETSAVEDIMAGE

- 功能说明: MID\_SNAPIMAGE 抓拍的图片将存储在模组中,主控获取抓拍图片时,首先调用 MID\_GETSAVEDIMAGE 命令获取待上传图片的大小,然后多次调用 MID\_UPLOADIMAGE 来分包获取图片数据。
- 输入参数: s msg get saved image data
- 返回参数:无
- 指令代码: 17H
- 指令包格式:

|          |       | Si  | ze  | Data                                    |             |
|----------|-------|-----|-----|-----------------------------------------|-------------|
| SyncWord | MsgID | Н   | L   | s_msg_get_saved_image_data image_number | ParityCheck |
| EFAA     | 17H   | 000 | )1H | xxH                                     | xxH         |

- 参数说明:
  - 1) image number: 指定要获取的图像的编号。
- 指令包示例:
  - EF AA 17 0001 03 15, 获取编号为 03 即 3.jpg 的图像大小。
- 应答包格式:

|          |       | Si  | ze |     |        | Data                |        |
|----------|-------|-----|----|-----|--------|---------------------|--------|
|          |       |     |    |     |        | s_msg_reply_get_sav | Parity |
| SyncWord | MsgID | Н   | L  | mid | result | ed_image_data       | Check  |
|          |       |     |    |     |        | image_size[4]       |        |
| EFAA     | 00H   | XXX | хH | 17H | xxH    | xxxxxxxH            | xxH    |

应答包携带数据 s msg reply get saved image data 定义如下:

## $typedef\ struct\ \{$

uint8\_t image\_size[4]; // image size int -> [s1, s2, s3, s4]

} s msg reply get saved image data;

● 应答包示例

EFAA 00 0006 17 00 00003B5B 71, 获取编号为 03 的图像大小为 (0x00003B5B) 15195 字节。

注: result=00H(MR\_SUCCESS) 获取图像大小成功; result=13H(MR\_FAILED4\_READ\_FILE) 读取图像文件失败;

![](_page_34_Picture_1.jpeg)

## 1.12.14.3.上传抓拍图像数据 MID\_UPLOADIMAGE

- 功能说明:根据 MID\_GETSAVEDIMAGE 获取到的图像大小,通过串口分包上传抓拍图像给主控。
- 输入参数: s msg upload image data
- 返回参数:无 指令代码: 18H
- 指令包格式:

|           |      | Si  | ze                     | Da                   | ta          |        |
|-----------|------|-----|------------------------|----------------------|-------------|--------|
| SyncWord  | Msg  |     |                        | s_msg_upload         | _image_data | Parity |
| Syne word | ID H | H L | upload_image_offset[4] | upload_image_size[4] | Check       |        |
| EFAA      | 18H  | xx  | XXX                    | xxxxxxxH             | xxxxxxxH    | xxH    |

指令包中携带的 s msg upload image data 结构体定义如下:

```
typedef struct {
    uint8_t upload_image_offset[4]; // upload image offset, int -> [o1 o2 o3 o4]
    uint8_t upload_image_size[4]; // upload image size, int -> [s1 s2 s3 s4]
} s_msg_upload_image_data;
```

- 参数说明:
  - 1) upload\_image\_offset[4]:表示该次上传图像的偏移量;
  - 2) upload\_image\_size[4]:表示该次上传图像的大小,最大不超过 4000 字节;
- 指令包示例:

EFAA 18 0008 00000000 00000FA0 BF

EFAA 18 0008 00000FA0 00000FA0 10

EFAA 18 0008 00001F40 00000FA0 E0

EFAA 18 0008 00002EE0 00000C7B A9

模组上传大小为(0x3B5B)15195 字节的图像给主控,分 4 次发送,每次传送数据大小分别为 4000、4000、4000、3195 字节。

● 应答包格式:

| a w 1    | MsgID | Size |     |     | Data   |      |             |  |
|----------|-------|------|-----|-----|--------|------|-------------|--|
| SyncWord |       | Н    | L   | mid | result | data | ParityCheck |  |
| EFAA     | 02H   | XXX  | кхН | 18H | xxH    | 无    | xxH         |  |

● 应答包示例:

EF AA 02 0FA0 xxxxxx....xx

![](_page_35_Picture_1.jpeg)

注: MsgID=02H(MID\_IMAGE) 模组给主控传送图片 result=00H(MR\_SUCCESS) 抓取图像成功; result=06H(MR FAILED4 INVALIDPARAM) 指令包传参错误;

## <span id="page-35-0"></span>1.12.15. 获取断电保存的日志

● 功能说明: 模组断电前发送 MID\_POWERDOWN 指令,模组收到该指令后,模组会保存简单的日志文件,主控通过 MID\_GET\_LOGFILE & MID\_UPLOAD\_LOGFILE 获取日志文件。

## 1.12.15.1.断电保存日志 MID\_POWERDOWN

- 功能说明: 模组断电前发送该指令,模组收到该指令后,模组保存相应的 log。
- 输入参数:无
- 返回参数:无
- 指令代码: EDH
- 指令包格式:

| C W 1    | W ID  | Si  | ze  |      | ParityCheck |  |
|----------|-------|-----|-----|------|-------------|--|
| SyncWord | MsgID | Н   | L   | Data |             |  |
| EFAA     | EDH   | 000 | 00H | 无    | xxH         |  |

#### ● 应答包格式:

| ~ *** 1          |     | Size |    |     |        | n : at 1 |             |
|------------------|-----|------|----|-----|--------|----------|-------------|
| SyncWord   MsgID |     | Н    | L  | mid | result | data     | ParityCheck |
| EFAA             | 00H | 000  | 2H | EDH | xxH    | 无        | xxH         |

## 1.12.15.2.获取日志文件大小 MID\_GET\_LOGFILE

- 功能说明: MID\_POWERDOWN 模组保存日志,主控获取模组log,首先调用 MID\_GET\_LOGFILE 命令获取待上传 log 文件的大小,然后多次调用 MID\_UPLOAD\_LOGFILE 来分包获取 log 文件。使用方式与 MID GETSAVDIMAGE & MID UPLOADIMAGE 的使用方式完全相同。
- 输入参数:无
- 返回参数: s msg reply get log data
- 指令代码: 60H
- 指令包格式:

![](_page_36_Picture_1.jpeg)

| G W 1    | M ID  | Si    | ze | ъ.   | ParityCheck |
|----------|-------|-------|----|------|-------------|
| SyncWord | MsgID | Н     | L  | Data |             |
| EFAA     | 60H   | 0000Н |    | 无    | xxH         |

● 指令包示例: EFAA 60 0000 60

● 应答包格式:

|          |       | Size  |   |     |        |                                       |                 |
|----------|-------|-------|---|-----|--------|---------------------------------------|-----------------|
| SyncWord | MsgID | Н     | L | mid | result | s_msg_reply_get_1 og_data log_size[4] | Parity<br>Check |
| EFAA     | 00H   | xxxxH |   | 60H | xxH    | xxxxxxxH                              | xxH             |

应答包携带数据 s\_msg\_reply\_get\_log\_data 定义如下:

```
typedef struct {
    uint8_t log_size[4];    // log size int -> [s1, s2, s3, s4]
} s_msg_reply_get_log_data;
```

● 应答包示例:

EF AA 00 0006 60 00 00002F18 51, 获取的日志文件大小为: 00002F18(12056 Bytes)

## 1.12.15.3.获取日志文件 MID\_UPLOAD\_LOGFILE

- 功能说明: MID\_POWERDOWN 模组保存日志,主控获取模组 log,首先调用 MID\_GET\_LOGFILE 命令获取待上传 log 文件的大小,然后多次调用 MID\_UPLOAD\_LOGFILE 来分包获取 log 文件。上传上来的 log 文件是一个 tar 包,需要先解包再查看里面的内容。使用方式与MID GETSAVDIMAGE & MID UPLOADIMAGE 的使用方式完全相同。
- 输入参数:无
- 返回参数: s msg upload logfile data
- 指令代码: 61H
- 指令包格式:

|             |      | Size |                        | Da                   |          |     |
|-------------|------|------|------------------------|----------------------|----------|-----|
| SyncWord Ms |      |      |                        | s_msg_upload         | Parity   |     |
| Sylle Word  | ID H | L    | upload_image_offset[4] | upload_image_size[4] | Check    |     |
| EFAA        | 61H  | XX   | XX                     | xxxxxxxH             | xxxxxxxH | xxH |

![](_page_37_Picture_1.jpeg)

指令包中携带的 s msg upload logfile data 结构体定义如下:

#### typedef struct {

uint8\_t upload\_logfile\_offset[4]; // upload logfile offset, int -> [o1 o2 o3 o4]

uint8\_t upload\_logfile\_size[4]; // uploade logfile size, int -> [s1 s2 s3 s4]

} s\_msg\_upload\_logfile\_data;

- 参数说明:
  - 3) upload\_logfile\_offset[4]:表示该次上传日志的偏移量;
- 4) upload\_logfile\_size[4]:表示该次上传日志的大小,最大不超过 4000 字节:
- 指令包示例:

EF AA 61 0008 00000000 00000FA0 C6

EF AA 61 0008 00000FA0 00000FA0 69

EF AA 61 0008 00001F40 00000FA0 99

EF AA 61 0008 00 002EE0 00000038 9F

模组上传大小为 12056 字节的日志文件给主控, 分 4 次发送,

每次传送数据大小分别为 4000、4000、4000、56 字节。

● 应答包格式:

|          | MsgID | Size  |   |     |        |      |             |
|----------|-------|-------|---|-----|--------|------|-------------|
| SyncWord |       | Н     | L | mid | result | data | ParityCheck |
| EFAA     | 00H   | xxxxH |   | 18H | xxH    | 无    | xxH         |

● 应答包示例:

<span id="page-37-0"></span>EF AA 00 0FA0 xxxxxx....xx

## 1.12.16. 获取售后 debug 日志

● 功能说明:售后使用该功能,在终端用户配合下进入 debug 模式然后复现用户出现的问题,通过 MID\_GET\_DEBUG\_INFO 和 MID\_UPLOAD\_DEBUG\_INFO 指令获取相应的日志和图像数据,退出 debug 模式时会删除所有 debug 模式中保存的数据。

## 1.12.16.1.进入 debug 模式 MID\_DEBUG\_MODE

- 功能说明: 进入/退出 debug 模式
- 输入参数:无
- 返回参数:无
- 指令代码: F0H

![](_page_38_Picture_1.jpeg)

#### ● 指令包格式:

|          |       | Size  |  | Data                  |             |
|----------|-------|-------|--|-----------------------|-------------|
| SyncWord | MsgID | H L   |  | s_msg_debug_mode_data | ParityCheck |
| EFAA     | F0H   | 0001H |  | xxH                   | xxH         |

指令包中携带的 s msg debug mode data 结构体定义如下:

typedef struct {
 uint8\_t enable; // enable debug mode or not
} s\_msg\_debug\_mode\_data;

● 指令包示例:

进入 debug 模式: EFAA F0 0001 01 F0 退出 debug 模式: EFAA F0 0001 00 F1

● 应答包格式:

| SyncWord | MsgID | Size  |   |     | D 1 C1 1 |      |             |
|----------|-------|-------|---|-----|----------|------|-------------|
|          |       | Н     | L | mid | result   | data | ParityCheck |
| EFAA     | 00H   | xxxxH |   | F0H | xxH      | 无    | xxH         |

● 应答包示例:

EF AA 00 0002 F0 00 F2

# 1.12.16.2.获取 debug 数据 MID\_GET\_DEBUG\_INFO& MID\_UPLOAD\_DEBUG\_INFO

● 功能说明:售后使用该功能,在终端用户配合下打开 debug 模式然 后复现用户出现的问题,通过 MID\_GET\_DEBUG\_INFO 和 MID\_UPLOAD\_DEBUG\_INFO 指令获取相应的日志和图像数据,退出 debug 模式时会删除所有 debug 模式中保存的数据。这两条指令的使用方式与 MID\_GETSAVDIMAGE & MID\_UPLOADIMAGE 的使用方式完全相同.